#!/usr/bin/env bash

export PANE_FILE="/tmp/peco-glimpse-$$.pane"

EXIT_HANDLER="kill_pane_from_pane_file ${PANE_FILE}"
trap "${EXIT_HANDLER}" EXIT

SELECTED="$(rg --vimgrep "${@}" | peco)"
if [[ $? -eq "0" && -n "${SELECTED}" ]] ; then
    ${EXIT_HANDLER}
    FILES="$(echo "${SELECTED}" | awk -F ':' '{print "+" $2 ":" $3 " " $1}')"
    exec ${EDITOR} ${FILES}
fi
